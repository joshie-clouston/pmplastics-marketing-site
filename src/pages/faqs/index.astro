---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import StructuredData from '../../components/schema/StructuredData.astro';

export const prerender = true;

const faqPages = (await getCollection('faqs', ({ data }) => !data.draft));
const allQuestions = faqPages.flatMap((page) =>
  page.data.questions.map((q) => ({ ...q, pageId: page.id, pageTitle: page.data.title }))
);
---
<BaseLayout title="FAQs" description="Frequently asked questions about plastic fabrication, laser cutting, engraving, and materials. P&M Plastics, Gold Coast.">
  <StructuredData slot="structured-data" data={{
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": allQuestions.map((q) => ({
      "@type": "Question",
      "name": q.question,
      "acceptedAnswer": { "@type": "Answer", "text": q.answer },
    })),
  }} />

  <section class="section bg-secondary text-secondary-foreground">
    <div class="container mx-auto text-center">
      <h1 class="text-4xl sm:text-5xl font-900 tracking-tight mb-4" data-animate="fade-up">FAQs</h1>
      <p class="text-lg text-gray-400 max-w-2xl mx-auto" data-animate="fade-up">
        Common questions about our services, materials, and processes.
      </p>
    </div>
  </section>

  <section class="section bg-white">
    <div class="container mx-auto max-w-3xl">
      {faqPages.map((page) => (
        <div class="mb-10 last:mb-0">
          <h2 class="text-2xl font-700 mb-4" data-animate="fade-up">
            <a href={`/faqs/${page.id}`} class="hover:text-primary transition-colors">{page.data.title}</a>
          </h2>
          <div class="space-y-3" data-animate="stagger">
            {page.data.questions.slice(0, 3).map((q) => (
              <details class="group border border-border rounded-xl overflow-hidden">
                <summary class="flex items-center justify-between cursor-pointer p-4 font-600 text-foreground hover:bg-muted/50 transition-colors text-sm">
                  {q.question}
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0 ml-4 text-muted-foreground group-open:rotate-180 transition-transform"><polyline points="6 9 12 15 18 9"/></svg>
                </summary>
                <div class="px-4 pb-4 text-muted-foreground text-sm leading-relaxed">{q.answer}</div>
              </details>
            ))}
          </div>
          {page.data.questions.length > 3 && (
            <a href={`/faqs/${page.id}`} class="inline-flex items-center gap-1 text-primary text-sm font-600 mt-3 hover:underline">
              View all {page.data.questions.length} questions
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
            </a>
          )}
        </div>
      ))}
    </div>
  </section>
</BaseLayout>
