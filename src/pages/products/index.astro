---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import ContentCard from '../../components/ui/ContentCard.astro';
import SecondaryCTA from '../../components/sections/SecondaryCTA.astro';
import BreadcrumbSchema from '../../components/schema/BreadcrumbSchema.astro';
import ItemListSchema from '../../components/schema/ItemListSchema.astro';
import { resolveImage } from '../../lib/images';

export const prerender = true;

const products = (await getCollection('products', ({ data }) => !data.draft))
  .sort((a, b) => a.data.order - b.data.order);

const categories = Object.groupBy(products, (p) => p.data.category ?? 'Other');
---
<BaseLayout title="Products" description="Custom plastic products â€” sneeze guards, skylight covers, pool safety panels, display cases, and more. P&M Plastics, Gold Coast.">
  <BreadcrumbSchema items={[{ name: 'Products', href: '/products' }]} slot="structured-data" />
  <ItemListSchema name="Custom Plastic Products" description="Custom plastic products manufactured by P&M Plastics" items={products.map((p) => ({ name: p.data.title, url: `/products/${p.id}` }))} slot="structured-data" />

  <section class="section bg-secondary text-secondary-foreground">
    <div class="container mx-auto text-center">
      <h1 class="text-4xl sm:text-5xl font-900 tracking-tight mb-4" data-animate="fade-up">Our Products</h1>
      <p class="text-lg text-gray-400 max-w-2xl mx-auto" data-animate="fade-up">
        Custom plastic products for home, business, and industry. If you can imagine it, we can make it.
      </p>
    </div>
  </section>

  <section class="section bg-white">
    <div class="container mx-auto">
      {Object.entries(categories).map(([category, items]) => (
        <div class="mb-12 last:mb-0">
          <h2 class="text-2xl font-700 mb-6 capitalize" data-animate="fade-up">{category}</h2>
          <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6" data-animate="stagger">
            {items!.map((product) => (
              <ContentCard
                href={`/products/${product.id}`}
                title={product.data.title}
                description={product.data.description}
                image={product.data.image ? resolveImage(product.data.image) : undefined}
              />
            ))}
          </div>
        </div>
      ))}
    </div>
  </section>

  <SecondaryCTA
    heading="Don't see what you need?"
    description="We fabricate custom plastic products for any application. Tell us what you need."
  />
</BaseLayout>
